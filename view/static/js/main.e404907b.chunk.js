(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{249:function(e,t,a){e.exports=a(540)},254:function(e,t,a){},257:function(e,t){},346:function(e,t,a){},349:function(e,t,a){},540:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),o=a(7),r=a.n(o),s=(a(254),a(247)),l=a(69),c=a(111),u=a(116),d=a(112),p=a(117),m=a(88),h=a(542),f=a(551),g=a(546),v=a(545),y=a(547),b=a(549),E=a(548),S=a(14),k=a(151),C=a(543),j=a(550),x=a(544),w=a(152),L=a.n(w),T=function e(){Object(l.a)(this,e)};T.DEBUG=!1,T.API="",T.IMG_API="",T.HTTP="https:"==window.location.protocol?"https://":"http://",T.IMG_UPLOAD=T.API+"/api/static/img/upload",T.FILE_UPLOAD=T.API+"/api/static/img/upload";var A=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,null,[{key:"request",value:function(e){var t=this;e.beforeRequest&&"function"===typeof e.beforeRequest&&e.beforeRequest();return fetch(this.API+e.api,{method:e.method||"POST",credentials:"include",headers:{charset:"UTF-8","Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.params)}).then(function(e){return e.json()}).then(function(a){if(e.afterRequest&&"function"===typeof e.afterRequest&&e.afterRequest(),200===a.status)"function"===typeof e.success&&e.success(a.data);else if(403===a.status)e.sessionError&&e.sessionError();else{if(t.onerror)return;t.onerror=!0,t.error({title:"\u9519\u8bef",content:a.msg,okText:"\u77e5\u9053\u4e86",onOk:function(){t.onerror=!1}})}}).catch(function(a){if(console.error(a),e.afterRequest&&"function"===typeof e.afterRequest&&e.afterRequest(),e.onError&&"function"===typeof e.onError)e.onError(a);else{if(t.onerror)return;t.onerror=!0,t.error({title:"\u9519\u8bef",content:"\u7cfb\u7edf\u5f02\u5e38\uff01",okText:"\u77e5\u9053\u4e86",onOk:function(){t.onerror=!1}})}})}},{key:"guid",value:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"saltMd5",value:function(e){return L.a.hex(this.salt(e)+"&"+this.GUID+"&"+e)}},{key:"md5",value:function(e){return L.a.hex(e)}},{key:"salt",value:function(e){for(var t="",a=0;a<e.length;a++)t+=e.charAt(a).charCodeAt();return t}},{key:"deepclone",value:function(e){if("object"===typeof e){if(null===e)return null;if(void 0!==e){var t=e instanceof Array?[]:{};for(var a in e)e.hasOwnProperty(a)&&(t[a]="object"===typeof e[a]?this.deepclone(e[a]):e[a]);return t}}}}]),t}(T),N=a(153),O=a.n(N),I=a(89),D=a(232),P=a(154),q=a.n(P),R=(a(346),a(349),h.a.Content),B=h.a.Sider,G=f.b.SubMenu,U=g.a.Item,M=v.a.TabPane,z=y.a.Option,F=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).src="/project/",a.state={collapsed:!1,visible:!1,menu:[],user:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,src:"/project/welcome",visibleAdd:!1,addType:"1",fileList:[],editorState:I.EditorState.createEmpty()},a.showModal=function(){a.setState({visible:!0})},a.dologin=function(){var e=Object(m.a)(Object(m.a)(a));A.request({api:"/login",params:{user:a.state.name,password:A.md5(a.state.password)},beforeRequest:function(){e.setState({logining:!0})},afterRequest:function(){e.setState({logining:!1})},success:function(t){localStorage.setItem("user",JSON.stringify(t)),e.setState({user:t,visible:!1})}})},a.onCollapse=function(e){console.log(e),a.setState({collapsed:e})},a.handleUpload=function(){var e=a.state.fileList,t=new FormData;t.append("file",e[0]),t.append("addTo",a.state.addTo),t.append("version",a.state.version),t.append("isGBK",a.state.isGBK?1:0),a.setState({addLoading:!0}),O()({url:A.API+"/upload",method:"post",processData:!1,withCredentials:!0,data:t,success:function(e){403===(e=JSON.parse(e.response)).status?a.setState({visibleAdd:!1,visible:!0,addLoading:!1}):200===e.status&&(a.setState({fileList:[],addLoading:!1,visibleAdd:!1}),a.init())},error:function(){a.setState({addLoading:!1})}})},a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onEditorStateChange",value:function(e){this.setState({editorState:e})}},{key:"logout",value:function(){var e=this;A.request({api:"/logout",afterRequest:function(){localStorage.clear(),e.setState({user:null})}})}},{key:"componentWillMount",value:function(){this.init()}},{key:"init",value:function(){var e=this;A.request({api:"/project",method:"GET",success:function(t){e.setState({menu:t})}})}},{key:"addTypeChange",value:function(e){this.setState({addType:e})}},{key:"calcDisAbled",value:function(){return"1"===this.state.addType?!this.state.projectName:!this.state.version||!this.state.addTo||!this.state.fileList||this.state.fileList.length<1}},{key:"calcDisAbledDoc",value:function(){return!this.state.documentName||!this.state.addTo||!q()(Object(I.convertToRaw)(this.state.editorState.getCurrentContent()))}},{key:"doAdd",value:function(){var e=this;switch(this.state.addType){case"1":A.request({api:"/project/add",params:{projectName:this.state.projectName},beforeRequest:function(){e.setState({addLoading:!0})},afterRequest:function(){e.setState({addLoading:!1})},sessionError:function(){e.setState({visibleAdd:!1,visible:!0})},success:function(){e.setState({visibleAdd:!1}),e.init()}});break;case"2":this.handleUpload()}}},{key:"share",value:function(){this.setState({sharevisible:!0})}},{key:"removeProject",value:function(e){var t="",a=this;b.a.confirm({title:"Sure remove this project",content:i.a.createElement(E.a,{type:"password",placeholder:"password",onChange:function(e){t=e.target.value}}),okText:"Ok",cancelText:"Cancel",onOk:function(){return A.request({api:"/project/remove",params:{projectName:e,password:A.md5(t)},success:function(){a.init()},sessionError:function(){a.setState({visibleAdd:!1,visible:!0})}})}})}},{key:"onImgUploaded",value:function(e){var t=this,a=new FormData;return a.append("img",e),new Promise(function(e,n){O()({url:A.API+"/upload/img",method:"post",processData:!1,withCredentials:!0,data:a}).then(function(e){return JSON.parse(e.response)}).then(function(a){403===a.status?(t.setState({addDocumentVisible:!1,visible:!0}),n()):200===a.status&&e({data:{link:A.IMG_API+a.data}})},function(e,t){n(e)})})}},{key:"render",value:function(){var e=this,t=this;return i.a.createElement(h.a,{style:{minHeight:"100vh"}},i.a.createElement(B,{theme:"light",collapsible:!0,collapsed:this.state.collapsed,onCollapse:this.onCollapse},i.a.createElement("div",{className:"logo"}),i.a.createElement(f.b,{mode:"inline"},this.state.menu.map(function(a,n){return i.a.createElement(G,{key:n,title:i.a.createElement("span",null,i.a.createElement(S.a,{type:"project"}),i.a.createElement("span",null,a.name))},a.project.map(function(o,r){var s=i.a.createElement("div",{style:{position:"relative"}},i.a.createElement("span",null,o),t.state.user?i.a.createElement("div",{style:{position:"absolute",right:"12px",display:"inline-block"}},i.a.createElement(S.a,{className:"project-remove",onClick:function(t){t.stopPropagation(),e.removeProject(a.name+"/"+o)},style:{color:"#ff0000"},type:"delete"})):null);return i.a.createElement(f.b.Item,{key:n+"-"+r,onClick:function(){return e.setState({src:e.src+a.name+"/"+o})}},s)}))}))),i.a.createElement(h.a,{className:"App"},i.a.createElement("div",{className:"header"},this.state.user?i.a.createElement("div",{style:{display:"inline-block"}},i.a.createElement(k.a,{type:"primary",style:{marginLeft:"12px"},onClick:function(){return e.setState({visibleAdd:!0,addTo:"",version:"",fileList:[],projectName:""})}},i.a.createElement(S.a,{type:"folder-add"}),"New Project"),i.a.createElement(k.a,{type:"primary",onClick:function(){return e.setState({addDocumentVisible:!0,addTo:"",version:"",fileList:[],projectName:"",documentName:""})}},i.a.createElement(S.a,{type:"file-word"}),"New Document"),i.a.createElement(k.a,{type:"default",onClick:this.share.bind(this)},i.a.createElement(S.a,{type:"share-alt"}),"Share")):i.a.createElement("div",{style:{display:"inline-block"}},i.a.createElement(k.a,{style:{marginLeft:"12px"},type:"default",onClick:this.share.bind(this)},i.a.createElement(S.a,{type:"share-alt"}),"Share")),this.state.user?i.a.createElement("span",{style:{marginRight:"24px",height:"60px",display:"inline-block",float:"right"}},i.a.createElement(C.a,{style:{backgroundColor:"#87d068",marginRight:"12px"},icon:"user"}),i.a.createElement("span",{style:{color:"#333"}},"Hello\uff01",this.state.user.username),i.a.createElement("a",{href:"javascript:void(0)",style:{marginLeft:"12px"},onClick:function(){return e.logout.bind(e)()}},"Logout")):i.a.createElement(k.a,{type:"primary",onClick:function(){return e.setState({visible:!0})}},"Login")),i.a.createElement(R,{style:{height:"100%",position:"relative"}},i.a.createElement("iframe",{src:this.state.src,title:"Project"}))),i.a.createElement(b.a,{title:"Login",visible:this.state.visible,onOk:this.dologin,onCancel:function(){return e.setState({visible:!1})},okText:"Login",cancelText:"Cancel"},i.a.createElement(g.a,{onSubmit:this.handleSubmit,className:"login-form"},i.a.createElement(U,null,i.a.createElement(E.a,{maxLength:20,prefix:i.a.createElement(S.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),onChange:function(t){return e.setState({name:t.target.value})},placeholder:"user name"})),i.a.createElement(U,null,i.a.createElement(E.a,{maxLength:16,prefix:i.a.createElement(S.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),onChange:function(t){return e.setState({password:t.target.value})},type:"password",placeholder:"password"})))),i.a.createElement(b.a,{visible:this.state.sharevisible,title:"\u5206\u4eab",onOk:function(){document.getElementById("share-link").select();try{var t=document.execCommand("copy");alert(t?"Succeed!":"not support"),e.setState({sharevisible:!1})}catch(a){alert("not support")}},okText:"Copy Link",cancelText:"Cancel",onCancel:function(){return e.setState({sharevisible:!1})}},i.a.createElement(g.a,{onSubmit:this.handleSubmit,className:"login-form"},i.a.createElement(U,null,i.a.createElement(E.a,{id:"share-link",value:this.state.src,prefix:i.a.createElement(S.a,{type:"link",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"share"})))),i.a.createElement(b.a,{visible:this.state.addDocumentVisible,title:i.a.createElement("div",null,i.a.createElement("span",{style:{fontSize:"14px"}},"Add to\uff1a"),i.a.createElement(y.a,{onChange:function(t){e.setState({addTo:t})},className:"prefix-icon",value:this.state.addTo,suffixIcon:i.a.createElement(S.a,{type:"project",style:{color:"rgba(0,0,0,.25)"}}),style:{width:"300px",marginRight:"12px"},placeholder:"chose the target group"},this.state.menu.map(function(e,t){return i.a.createElement(z,{key:t,value:e.name},e.name)})),i.a.createElement("span",{style:{fontSize:"14px"}},"Document\uff1a"),i.a.createElement(E.a,{value:this.state.documentName,style:{width:"300px"},maxLength:20,prefix:i.a.createElement(S.a,{type:"file-unknown",style:{color:"rgba(0,0,0,.25)"}}),onChange:function(t){return e.setState({documentName:t.target.value})},placeholder:"document title"})),onOk:function(){var t=e;A.request({api:"/doc/add",params:{projectName:e.state.projectName,addTo:e.state.addTo,documentName:e.state.documentName,content:q()(Object(I.convertToRaw)(e.state.editorState.getCurrentContent()))},beforeRequest:function(){t.setState({addDocLoading:!0})},afterRequest:function(){t.setState({addDocLoading:!1})},sessionError:function(){t.setState({addDocumentVisible:!1,visible:!0})},success:function(){t.setState({addDocumentVisible:!1}),t.init()}})},width:900,okText:"Save",cancelText:"Cancel",okButtonProps:{disabled:this.calcDisAbledDoc(),loading:this.state.addDocLoading},onCancel:function(){return e.setState({addDocumentVisible:!1})}},i.a.createElement("div",null,i.a.createElement(D.Editor,{localization:{locale:"zh"},toolbar:{options:["inline","blockType","fontSize","fontFamily","list","textAlign","colorPicker","link","embedded","emoji","image","remove","history"],image:{className:void 0,component:void 0,popupClassName:void 0,urlEnabled:!0,uploadEnabled:!0,alignmentEnabled:!0,uploadCallback:this.onImgUploaded.bind(this),previewImage:!0,inputAccept:"image/gif,image/jpeg,image/jpg,image/png,image/svg",alt:{present:!1,mandatory:!1},defaultSize:{height:"auto",width:"auto"}}},editorState:this.state.editorState,wrapperClassName:"demo-wrapper",editorClassName:"demo-editor",onEditorStateChange:this.onEditorStateChange.bind(this)}))),i.a.createElement(b.a,{visible:this.state.visibleAdd,onOk:this.doAdd.bind(this),onCancel:function(){return e.setState({visibleAdd:!1})},okText:"Add",cancelText:"Cancel",okButtonProps:{disabled:this.calcDisAbled(),loading:this.state.addLoading}},i.a.createElement(v.a,{defaultActiveKey:"1",onChange:this.addTypeChange.bind(this)},i.a.createElement(M,{tab:"Add Group",key:"1"},i.a.createElement("div",{style:{padding:"24px"}},i.a.createElement(E.a,{value:this.state.projectName,maxLength:20,prefix:i.a.createElement(S.a,{type:"project",style:{color:"rgba(0,0,0,.25)"}}),onChange:function(t){return e.setState({projectName:t.target.value})},placeholder:"input group name"}))),i.a.createElement(M,{tab:"Add Project",key:"2"},i.a.createElement("div",{style:{padding:"24px"}},i.a.createElement(y.a,{onChange:function(t){e.setState({addTo:t})},className:"prefix-icon",value:this.state.addTo,suffixIcon:i.a.createElement(S.a,{type:"project",style:{color:"rgba(0,0,0,.25)"}}),style:{width:"100%",marginBottom:"12px"},placeholder:"chose the target group"},this.state.menu.map(function(e,t){return i.a.createElement(z,{key:t,value:e.name},e.name)})),i.a.createElement(E.a,{value:this.state.version,maxLength:20,prefix:i.a.createElement(S.a,{type:"file-unknown",style:{color:"rgba(0,0,0,.25)"}}),onChange:function(t){return e.setState({version:t.target.value.replace(/\s+/g,"").replace(/([^\u0000-\u00FF])/g,"")})},placeholder:"version"}),i.a.createElement("div",{style:{margin:"12px 0"}},i.a.createElement(j.a,{checked:this.state.isGBK,onChange:function(t){return e.setState({isGBK:t.target.checked})}},"GBK")),i.a.createElement("div",{style:{margin:"12px 0",textAlign:"right"}},i.a.createElement(x.a,{action:A.API+"/upload",onChange:this.handleChange,multiple:!1,accept:".zip,.rar",withCredentials:!0,onRemove:function(t){e.setState(function(e){var a=e.fileList,n=a.indexOf(t),i=a.slice();return i.splice(n,1),{fileList:i}})},beforeUpload:function(t){return e.setState(function(e){var a=e.fileList;return{fileList:[].concat(Object(s.a)(a),[t])}}),!1},fileList:this.state.fileList},this.state.fileList.length>0?null:i.a.createElement(k.a,null,i.a.createElement(S.a,{type:"upload"})," Upload"))))))))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(F,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[249,2,1]]]);
//# sourceMappingURL=main.e404907b.chunk.js.map